<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenBank - Solusi Bank Sampah Digital</title>
    <style>
        :root {
            --primary: #2ecc71;
            --primary-dark: #27ae60;
            --secondary: #34495e;
            --accent: #f1c40f;
            --accent-red: #e74c3c;
            --accent-blue: #3498db;
            --bg-light: #f4f7f6;
            --white: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --danger: #e74c3c;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --radius: 12px;
            --radius-sm: 6px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--white);
        }

        .btn-accent {
            background-color: var(--accent);
            color: var(--text-dark);
        }

        .btn-danger {
            background-color: var(--danger);
            color: var(--white);
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2rem;
            color: var(--secondary);
            position: relative;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 60px;
            height: 4px;
            background-color: var(--primary);
            margin: 10px auto 0;
            border-radius: 2px;
        }

        .hidden {
            display: none !important;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: var(--bg-light);
            color: var(--text-dark);
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .badge.gold { background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; }
        .badge.silver { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); color: #000; }
        .badge.bronze { background: linear-gradient(135deg, #CD7F32, #A0522D); color: #fff; }
        .badge.green { background: var(--primary); color: white; }
        .badge.blue { background: var(--accent-blue); color: white; }

        header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--secondary);
            font-weight: 500;
            transition: color 0.3s;
            padding: 5px 0;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary);
        }

        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 80px 0;
            text-align: center;
            border-radius: 0 0 50px 50px;
            margin-bottom: 40px;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            border-top: 5px solid var(--primary);
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .section {
            padding: 60px 0;
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .price-table th, .price-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .price-table th {
            background-color: var(--secondary);
            color: var(--white);
        }

        .map-container {
            background-color: #eef2f3;
            height: 400px;
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(#dce4e6 2px, transparent 2px);
            background-size: 20px 20px;
        }

        .map-pin {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: var(--danger);
            border-radius: 50% 50% 0 50%;
            transform: rotate(45deg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .map-pin:hover {
            transform: rotate(45deg) scale(1.1);
            z-index: 10;
        }

        .map-pin i {
            transform: rotate(-45deg);
            color: white;
        }

        .map-tooltip {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }

        .map-pin:hover .map-tooltip {
            opacity: 1;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2);
        }

        .dashboard-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            flex: 1;
            background: var(--white);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            min-width: 200px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: var(--bg-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .stat-info h4 {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .stat-info p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
        }

        .chart-container {
            background: var(--white);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .simple-bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            padding-top: 20px;
            gap: 10px;
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            justify-content: flex-end;
            flex: 1;
        }

        .bar {
            width: 40px;
            background-color: var(--primary);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }
        
        .bar:hover::after {
            content: attr(data-value);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .bar-label {
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: var(--secondary);
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 2000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        footer {
            background-color: var(--secondary);
            color: var(--white);
            padding: 40px 0 20px;
            margin-top: 60px;
            text-align: center;
        }

        .footer-links {
            margin-bottom: 20px;
        }

        .footer-links a {
            color: #bdc3c7;
            text-decoration: none;
            margin: 0 10px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1500;
        }
        
        .modal-content {
            background: var(--white);
            padding: 30px;
            border-radius: var(--radius);
            width: 100%;
            max-width: 400px;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .reward-item {
            background: white;
            border: 2px solid #eee;
            border-radius: var(--radius-sm);
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .reward-item:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .reward-cost {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .leaderboard-table th {
            background: var(--secondary);
            color: white;
            padding: 15px;
        }

        .leaderboard-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .leaderboard-table tr:nth-child(1) { background: #fff9e6; }
        .leaderboard-table tr:nth-child(2) { background: #f5f5f5; }
        .leaderboard-table tr:nth-child(3) { background: #f9f0e6; }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .nav-links { 
                display: none; 
                position: absolute;
                top: 70px;
                left: 0;
                width: 100%;
                background: white;
                flex-direction: column;
                padding: 20px;
                box-shadow: var(--shadow);
            }
            .nav-links.show {
                display: flex;
            }
            .mobile-menu-btn {
                display: block;
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: var(--secondary);
            }
        }

        @media (min-width: 769px) {
            .mobile-menu-btn {
                display: none;
            }
        }

        .mobile-menu-btn {
            display: none;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- NAVIGATION -->
    <header>
        <div class="container">
            <nav>
                <a href="#" onclick="navigate('home')" class="logo">
                    <i class="fas fa-recycle"></i> GreenBank
                </a>
                
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                
                <ul class="nav-links" id="mainNav">
                    <li><a href="#" onclick="navigate('home')" class="active">Beranda</a></li>
                    <li><a href="#" onclick="navigate('info')">Info & Edukasi</a></li>
                    <li><a href="#" onclick="navigate('services')">Layanan</a></li>
                    <li><a href="#" onclick="navigate('news')">Berita</a></li>
                    <li><a href="#" onclick="navigate('rewards')" id="rewardsNav" class="hidden">Hadiah</a></li>
                    <li><a href="#" onclick="navigate('leaderboard')" id="leaderboardNav" class="hidden">Leaderboard</a></li>
                    <li id="authLink"><a href="#" onclick="openModal('loginModal')" class="btn btn-primary">Masuk</a></li>
                    <li id="dashboardLink" class="hidden"><a href="#" onclick="navigate('dashboard')" class="btn btn-secondary">Dashboard</a></li>
                    <li id="logoutLink" class="hidden"><a href="#" onclick="logout()" class="btn btn-danger">Keluar</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="container">
        <!-- HOME SECTION -->
        <section id="home" class="view">
            <div class="hero">
                <h1>Ubah Sampah Jadi Cuan</h1>
                <p>Kelola sampah Anda dengan mudah, pantau tabungan, dan jaga lingkungan bersama GreenBank.</p>
                <button class="btn btn-secondary" onclick="openModal('registerModal')">Daftar Sekarang</button>
                <div style="margin-top: 20px;">
                    <span class="badge green"><i class="fas fa-leaf"></i> Ramah Lingkungan</span>
                    <span class="badge blue"><i class="fas fa-mobile-alt"></i> Digital</span>
                    <span class="badge gold"><i class="fas fa-award"></i> Reward System</span>
                </div>
            </div>

            <div class="grid-3">
                <div class="card">
                    <div class="card-icon"><i class="fas fa-coins"></i></div>
                    <h3>Tabungan Sampah</h3>
                    <p>Setor sampah Anda, kami timbang, dan saldo bertambah. Cairkan kapan saja.</p>
                </div>
                <div class="card">
                    <div class="card-icon"><i class="fas fa-truck"></i></div>
                    <h3>Penjemputan</h3>
                    <p>Sampah menumpuk? Jadwalkan penjemputan dari rumah Anda.</p>
                </div>
                <div class="card">
                    <div class="card-icon"><i class="fas fa-gift"></i></div>
                    <h3>Hadiah & Reward</h3>
                    <p>Tukar poin dengan pulsa, voucher, atau produk menarik lainnya.</p>
                </div>
            </div>
        </section>

        <!-- INFO SECTION -->
        <section id="info" class="view hidden">
            <h2 class="section-title">Informasi Jenis Sampah</h2>
            
            <div class="grid-3" style="margin-bottom: 40px;">
                <div class="card">
                    <div style="width:100%; height:200px; background:#3498db; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 4rem;">
                        <i class="fas fa-wine-bottle"></i>
                    </div>
                    <h3>Sampah Plastik</h3>
                    <p>Botol PET, gelas plastik, kresek. Pastikan sudah bersih dan kering.</p>
                    <div class="badge green">Rp 4.000/kg</div>
                </div>
                <div class="card">
                    <div style="width:100%; height:200px; background:#e67e22; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 4rem;">
                        <i class="fas fa-newspaper"></i>
                    </div>
                    <h3>Sampah Kertas</h3>
                    <p>Koran, kardus, kertas HVS. Jangan basah atau terkontaminasi minyak.</p>
                    <div class="badge green">Rp 3.000/kg</div>
                </div>
                <div class="card">
                    <div style="width:100%; height:200px; background:#95a5a6; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 4rem;">
                        <i class="fas fa-industry"></i>
                    </div>
                    <h3>Sampah Logam</h3>
                    <p>Kaleng minuman, besi tua, aluminium. Nilai jual tinggi.</p>
                    <div class="badge green">Rp 15.000/kg</div>
                </div>
            </div>

            <h2 class="section-title">Daftar Harga Sampah (Per Kg)</h2>
            <table class="price-table">
                <thead>
                    <tr>
                        <th>Jenis Sampah</th>
                        <th>Kategori</th>
                        <th>Harga (Rp)</th>
                    </tr>
                </thead>
                <tbody id="priceTableBody">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </section>

        <!-- SERVICES SECTION -->
        <section id="services" class="view hidden">
            <h2 class="section-title">Layanan Kami</h2>

            <div class="grid-3">
                <!-- Penjemputan -->
                <div class="card">
                    <h3><i class="fas fa-truck-pickup"></i> Jemput Sampah</h3>
                    <form id="pickupForm" onsubmit="handlePickup(event)">
                        <div class="form-group">
                            <label>Jenis Sampah</label>
                            <select id="pickupType" required>
                                <option value="campur">Campur</option>
                                <option value="plastik">Plastik</option>
                                <option value="kertas">Kertas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Estimasi Berat (Kg)</label>
                            <input type="number" id="pickupWeight" min="1" required>
                        </div>
                        <div class="form-group">
                            <label>Tanggal Jemput</label>
                            <input type="date" id="pickupDate" required>
                        </div>
                        <div class="form-group">
                            <label>Alamat</label>
                            <textarea id="pickupAddress" rows="2" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Request Jemput</button>
                    </form>
                </div>

                <!-- Pelaporan -->
                <div class="card">
                    <h3><i class="fas fa-camera"></i> Lapor Tumpukan</h3>
                    <form id="reportForm" onsubmit="handleReport(event)">
                        <div class="form-group">
                            <label>Lokasi (Deskripsi)</label>
                            <input type="text" id="reportLoc" placeholder="Contoh: Taman Kota Blok A" required>
                        </div>
                        <div class="form-group">
                            <label>Catatan</label>
                            <textarea id="reportNote" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-danger" style="width: 100%;">Kirim Laporan</button>
                    </form>
                </div>

                <!-- Peta Lokasi -->
                <div class="card">
                    <h3><i class="fas fa-map-marked-alt"></i> Peta TPS & Bank Sampah</h3>
                    <div class="map-container" id="mapArea">
                        <div class="map-pin" style="top: 30%; left: 40%;" onclick="showMapInfo('TPS Utama GreenBank')">
                            <i class="fas fa-recycle"></i>
                            <div class="map-tooltip">TPS Utama GreenBank</div>
                        </div>
                        <div class="map-pin" style="top: 60%; left: 70%; background-color: var(--primary);" onclick="showMapInfo('Cabang Selatan')">
                            <i class="fas fa-warehouse"></i>
                            <div class="map-tooltip">Cabang Selatan</div>
                        </div>
                        <div class="map-pin" style="top: 20%; left: 80%; background-color: var(--accent);" onclick="showMapInfo('Mobil Keliling')">
                            <i class="fas fa-truck"></i>
                            <div class="map-tooltip">Mobil Keliling (Hari Ini)</div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-light);">Klik pin untuk melihat info lokasi.</p>
                    <div id="mapInfoDisplay" style="margin-top:10px; font-weight:bold; color:var(--primary);"></div>
                </div>
            </div>

            <!-- Jadwal -->
            <div style="margin-top: 40px;">
                <h3><i class="far fa-calendar-alt"></i> Jadwal Pengangkutan Rutin</h3>
                <table class="price-table" style="margin-top: 20px;">
                    <thead>
                        <tr>
                            <th>Hari</th>
                            <th>Area</th>
                            <th>Jam</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Senin</td><td>Area Utara</td><td>08:00 - 10:00</td></tr>
                        <tr><td>Rabu</td><td>Area Selatan</td><td>13:00 - 15:00</td></tr>
                        <tr><td>Jumat</td><td>Area Pusat</td><td>09:00 - 11:00</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- REWARDS SECTION -->
        <section id="rewards" class="view hidden">
            <h2 class="section-title">Tukar Poin dengan Hadiah</h2>
            <div style="text-align: center; margin-bottom: 30px;">
                <div class="badge gold" style="font-size: 1.2rem; padding: 10px 20px;">
                    <i class="fas fa-coins"></i> Poin Anda: <span id="userPoints">0</span> poin
                </div>
            </div>

            <div class="grid-3" id="rewardsCatalog">
                <!-- Generated by JavaScript -->
            </div>

            <div class="card" style="margin-top: 40px;">
                <h3><i class="fas fa-trophy"></i> Achievement Badges</h3>
                <div class="achievement-grid" id="achievementGrid">
                    <!-- Generated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- LEADERBOARD SECTION -->
        <section id="leaderboard" class="view hidden">
            <h2 class="section-title">Leaderboard Pengguna Terbaik</h2>
            <div style="text-align: center; margin-bottom: 30px;">
                <div class="badge-container" style="display: flex; justify-content: center; gap: 20px; margin-bottom: 30px;">
                    <div style="text-align: center;">
                        <div class="badge gold" style="font-size: 1.5rem; padding: 15px 25px;">
                            <i class="fas fa-crown"></i> #1
                        </div>
                        <p style="margin-top: 10px; font-weight: bold;" id="top1Name">-</p>
                    </div>
                    <div style="text-align: center;">
                        <div class="badge silver" style="font-size: 1.5rem; padding: 15px 25px;">
                            <i class="fas fa-medal"></i> #2
                        </div>
                        <p style="margin-top: 10px; font-weight: bold;" id="top2Name">-</p>
                    </div>
                    <div style="text-align: center;">
                        <div class="badge bronze" style="font-size: 1.5rem; padding: 15px 25px;">
                            <i class="fas fa-award"></i> #3
                        </div>
                        <p style="margin-top: 10px; font-weight: bold;" id="top3Name">-</p>
                    </div>
                </div>
            </div>

            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>Peringkat</th>
                        <th>Nama</th>
                        <th>Total Berat (kg)</th>
                        <th>Total Poin</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- Generated by JavaScript -->
                </tbody>
            </table>
        </section>

        <!-- DASHBOARD SECTION -->
        <section id="dashboard" class="view hidden">
            <h2 class="section-title" id="dashboardTitle">Dashboard Pengguna</h2>

            <!-- User Stats -->
            <div id="userDashboard">
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                        <div class="stat-info">
                            <h4>Total Saldo</h4>
                            <p id="userBalance">Rp 0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-weight-hanging"></i></div>
                        <div class="stat-info">
                            <h4>Total Berat</h4>
                            <p id="userWeight">0 Kg</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-coins"></i></div>
                        <div class="stat-info">
                            <h4>Total Poin</h4>
                            <p id="userPointsDash">0</p>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Statistik Penyetoran (6 Bulan Terakhir)</h3>
                    <div class="simple-bar-chart" id="userChart">
                        <!-- Bars injected by JS -->
                    </div>
                </div>

                <div class="card">
                    <h3>Riwayat Transaksi</h3>
                    <table class="price-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Jenis</th>
                                <th>Berat</th>
                                <th>Total (Rp)</th>
                                <th>Poin</th>
                            </tr>
                        </thead>
                        <tbody id="userHistoryBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="hidden">
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h4>Total User</h4>
                            <p id="totalUsersCount">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-bell"></i></div>
                        <div class="stat-info">
                            <h4>Request Jemput</h4>
                            <p id="pendingPickups">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="stat-info">
                            <h4>Laporan Sampah</h4>
                            <p id="totalReports">0</p>
                        </div>
                    </div>
                </div>

                <div class="grid-3">
                    <div class="card" style="grid-column: span 2;">
                        <h3>Daftar Permintaan Penjemputan</h3>
                        <table class="price-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Tanggal</th>
                                    <th>Jenis</th>
                                    <th>Alamat</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminPickupTable"></tbody>
                        </table>
                    </div>
                    <div class="card">
                        <h3>Laporan Tumpukan</h3>
                        <div id="adminReportList">
                            <!-- Reports list -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- NEWS SECTION -->
        <section id="news" class="view hidden">
            <h2 class="section-title">Berita & Pengumuman</h2>
            <div class="grid-3">
                <div class="card">
                    <div style="width:100%; height:150px; background:#3498db; border-radius:8px; margin-bottom:15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                        <i class="fas fa-newspaper"></i>
                    </div>
                    <small style="color:var(--primary); font-weight:bold;">20 Oktober 2023</small>
                    <h3>Hari Peduli Sampah Nasional</h3>
                    <p>GreenBank mengadakan lomba kreasi tas dari sampah plastik. Daftarkan dirimu sekarang!</p>
                </div>
                <div class="card">
                    <div style="width:100%; height:150px; background:#2ecc71; border-radius:8px; margin-bottom:15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <small style="color:var(--primary); font-weight:bold;">15 Oktober 2023</small>
                    <h3>Kenaikan Harga Kardus</h3>
                    <p>Berita gembira bagi penyetor kardus! Harga beli naik 10% mulai bulan depan.</p>
                </div>
                <div class="card">
                    <div style="width:100%; height:150px; background:#f1c40f; border-radius:8px; margin-bottom:15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <small style="color:var(--primary); font-weight:bold;">10 Oktober 2023</small>
                    <h3>Tips Memilah Sampah</h3>
                    <p>Panduan lengkap cara memisahkan sampah organik dan anorganik dengan benar.</p>
                </div>
            </div>
        </section>

    </main>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="#" onclick="navigate('home')">Beranda</a>
                <a href="#" onclick="navigate('info')">Info</a>
                <a href="#" onclick="navigate('services')">Layanan</a>
                <a href="#" onclick="navigate('rewards')">Hadiah</a>
                <a href="#" onclick="navigate('leaderboard')">Leaderboard</a>
            </div>
            <p>&copy; 2025 GreenBank Indonesia. Oleh Tutur, Arif, Fatur, Naufal, Dzakwan (Tugas UAS).</p>
        </div>
    </footer>

    <!-- TOAST -->
    <div id="toast">Pesan Notifikasi</div>

    <!-- MODAL: LOGIN -->
    <div id="loginModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('loginModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">Masuk</h2>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="loginUser" required placeholder="user atau admin">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPass" required placeholder="1234">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Masuk</button>
            </form>
            <p style="margin-top: 10px; font-size: 0.9rem; text-align: center;">
                Belum punya akun? <a href="#" onclick="switchModal('loginModal', 'registerModal')" style="color: var(--primary);">Daftar</a>
            </p>
            <div style="margin-top: 15px; font-size: 0.8rem; background: #f0f0f0; padding: 10px; border-radius: 5px;">
                <strong>Demo:</strong><br>
                User: user / 1234<br>
                Admin: admin / admin
            </div>
        </div>
    </div>

    <!-- MODAL: REGISTER -->
    <div id="registerModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('registerModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">Daftar Baru</h2>
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Nama Lengkap</label>
                    <input type="text" id="regName" required>
                </div>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="regUser" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="regPass" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Daftar</button>
            </form>
        </div>
    </div>

    <!-- MODAL: REDEEM REWARD -->
    <div id="redeemModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('redeemModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;" id="redeemTitle">Tukar Hadiah</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <div id="rewardDetails"></div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" style="flex: 1;" onclick="confirmRedeem()">Ya, Tukar Sekarang</button>
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal('redeemModal')">Batal</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // --- DATA MOCKUP & STATE ---
        const db = {
            prices: [
                { type: 'Plastik PET (Botol)', price: 4000 },
                { type: 'Plastik Kresek', price: 2000 },
                { type: 'Kertas/Kardus', price: 3000 },
                { type: 'Kaleng Alumunium', price: 15000 },
                { type: 'Besi', price: 5000 },
                { type: 'Kaca Botol', price: 1000 }
            ],
            users: [
                { 
                    name: 'Budi Santoso', 
                    user: 'user', 
                    pass: '1234', 
                    role: 'user', 
                    balance: 150000, 
                    weight: 50, 
                    points: 1500,
                    history: [],
                    achievements: ['newbie', 'first_deposit', 'bronze_weight']
                },
                { 
                    name: 'Administrator', 
                    user: 'admin', 
                    pass: 'admin', 
                    role: 'admin', 
                    balance: 0, 
                    weight: 0, 
                    points: 0,
                    history: [], 
                    achievements: []
                }
            ],
            pickups: [],
            reports: [],
            rewards: [
                { id: 1, name: "Pulsa 10.000", points: 1000, icon: "fa-mobile-alt", color: "#3498db" },
                { id: 2, name: "Voucher Alfamart 20.000", points: 1800, icon: "fa-shopping-bag", color: "#2ecc71" },
                { id: 3, name: "Sabun Mandi", points: 500, icon: "fa-soap", color: "#9b59b6" },
                { id: 4, name: "Minyak Goreng 1L", points: 1200, icon: "fa-oil-can", color: "#e67e22" },
                { id: 5, name: "Paket Data 5GB", points: 1500, icon: "fa-wifi", color: "#e74c3c" },
                { id: 6, name: "Tumbler GreenBank", points: 2500, icon: "fa-wine-bottle", color: "#1abc9c" }
            ],
            achievements: [
                { id: 'newbie', name: 'Newbie', description: 'Pertama kali mendaftar', icon: 'fa-seedling', color: '#2ecc71' },
                { id: 'first_deposit', name: 'First Deposit', description: 'Melakukan setoran pertama', icon: 'fa-coins', color: '#f1c40f' },
                { id: 'bronze_weight', name: 'Bronze Weight', description: 'Menyetor 10kg sampah', icon: 'fa-weight-hanging', color: '#cd7f32' },
                { id: 'silver_weight', name: 'Silver Weight', description: 'Menyetor 50kg sampah', icon: 'fa-weight-hanging', color: '#c0c0c0' },
                { id: 'gold_weight', name: 'Gold Weight', description: 'Menyetor 100kg sampah', icon: 'fa-weight-hanging', color: '#ffd700' },
                { id: 'reporter', name: 'Reporter', description: 'Melaporkan sampah liar', icon: 'fa-flag', color: '#e74c3c' },
                { id: 'regular', name: 'Regular', description: '3 setoran berturut-turut', icon: 'fa-calendar-check', color: '#3498db' }
            ]
        };

        // Load from LocalStorage
        if (localStorage.getItem('greenBankDB')) {
            Object.assign(db, JSON.parse(localStorage.getItem('greenBankDB')));
        } else {
            // Seed some history for user
            db.users[0].history = [
                { date: '2023-08-01', type: 'Kertas/Kardus', weight: 5, total: 15000, points: 150 },
                { date: '2023-09-05', type: 'Plastik PET', weight: 10, total: 40000, points: 400 },
                { date: '2023-10-12', type: 'Kaleng', weight: 2, total: 30000, points: 300 }
            ];
            saveDB();
        }

        let currentUser = null;
        let selectedReward = null;

        // --- CORE FUNCTIONS ---
        function saveDB() {
            localStorage.setItem('greenBankDB', JSON.stringify(db));
        }

        function showToast(message, type = '') {
            const toast = document.getElementById("toast");
            toast.className = "show";
            toast.innerText = message;
            if (type) toast.classList.add(type);
            setTimeout(() => { 
                toast.className = toast.className.replace("show", "").replace(type, ""); 
            }, 3000);
        }

        function navigate(sectionId) {
            document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update active nav
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            document.querySelector(`a[onclick*="${sectionId}"]`).classList.add('active');
            
            // Special renders
            if (sectionId === 'info') renderPrices();
            if (sectionId === 'rewards' && currentUser) renderRewards();
            if (sectionId === 'leaderboard') renderLeaderboard();
            if (sectionId === 'dashboard' && currentUser) renderDashboard();
            
            window.scrollTo(0,0);
            closeMobileMenu();
        }

        function toggleMobileMenu() {
            const nav = document.querySelector('.nav-links');
            nav.classList.toggle('show');
        }

        function closeMobileMenu() {
            document.querySelector('.nav-links').classList.remove('show');
        }

        // --- AUTHENTICATION ---
        function openModal(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function switchModal(closeId, openId) {
            closeModal(closeId);
            openModal(openId);
        }

        function handleLogin(e) {
            e.preventDefault();
            const u = document.getElementById('loginUser').value;
            const p = document.getElementById('loginPass').value;

            const found = db.users.find(user => user.user === u && user.pass === p);

            if (found) {
                currentUser = found;
                updateUIForLogin();
                closeModal('loginModal');
                showToast(`Selamat datang, ${found.name}!`, 'success');
                navigate('dashboard');
            } else {
                showToast('Username atau password salah!', 'error');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const user = document.getElementById('regUser').value;
            const pass = document.getElementById('regPass').value;

            if(db.users.find(u => u.user === user)) {
                showToast('Username sudah dipakai!', 'error');
                return;
            }

            const newUser = {
                name, user, pass, role: 'user', 
                balance: 0, weight: 0, points: 100, // Bonus 100 poin untuk pendaftaran
                history: [],
                achievements: ['newbie']
            };

            db.users.push(newUser);
            saveDB();
            showToast('Registrasi berhasil! Dapat 100 poin bonus.', 'success');
            switchModal('registerModal', 'loginModal');
        }

        function logout() {
            currentUser = null;
            document.getElementById('authLink').classList.remove('hidden');
            document.getElementById('dashboardLink').classList.add('hidden');
            document.getElementById('logoutLink').classList.add('hidden');
            document.getElementById('rewardsNav').classList.add('hidden');
            document.getElementById('leaderboardNav').classList.add('hidden');
            navigate('home');
            showToast('Anda telah keluar.', 'success');
        }

        function updateUIForLogin() {
            document.getElementById('authLink').classList.add('hidden');
            document.getElementById('dashboardLink').classList.remove('hidden');
            document.getElementById('logoutLink').classList.remove('hidden');
            document.getElementById('rewardsNav').classList.remove('hidden');
            document.getElementById('leaderboardNav').classList.remove('hidden');
        }

        // --- FEATURES LOGIC ---
        function renderPrices() {
            const tbody = document.getElementById('priceTableBody');
            tbody.innerHTML = '';
            db.prices.forEach(item => {
                const row = `<tr><td>${item.type}</td><td>Daur Ulang</td><td>Rp ${item.price.toLocaleString()}</td></tr>`;
                tbody.innerHTML += row;
            });
        }

        function showMapInfo(text) {
            document.getElementById('mapInfoDisplay').innerText = "Lokasi Terpilih: " + text;
        }

        function handlePickup(e) {
            e.preventDefault();
            if (!currentUser) {
                showToast('Silakan login terlebih dahulu!', 'error');
                openModal('loginModal');
                return;
            }

            const type = document.getElementById('pickupType').value;
            const weight = document.getElementById('pickupWeight').value;
            const date = document.getElementById('pickupDate').value;
            const addr = document.getElementById('pickupAddress').value;

            db.pickups.push({
                user: currentUser.user,
                date, type, weight, address: addr, status: 'Pending'
            });
            saveDB();
            showToast('Permintaan penjemputan dikirim!', 'success');
            document.getElementById('pickupForm').reset();
        }

        function handleReport(e) {
            e.preventDefault();
            if (!currentUser) {
                showToast('Silakan login terlebih dahulu!', 'error');
                openModal('loginModal');
                return;
            }

            const loc = document.getElementById('reportLoc').value;
            const note = document.getElementById('reportNote').value;
            
            db.reports.push({ 
                user: currentUser.user,
                loc, note, 
                status: 'Baru',
                date: new Date().toISOString().split('T')[0]
            });
            
            // Give points for reporting
            const userIndex = db.users.findIndex(u => u.user === currentUser.user);
            db.users[userIndex].points += 100;
            
            // Add reporter achievement if not already
            if (!db.users[userIndex].achievements.includes('reporter')) {
                db.users[userIndex].achievements.push('reporter');
            }
            
            saveDB();
            showToast('Laporan berhasil dikirim! Dapat 100 poin.', 'success');
            document.getElementById('reportForm').reset();
        }

        // --- REWARDS SYSTEM ---
        function renderRewards() {
            const container = document.getElementById('rewardsCatalog');
            container.innerHTML = '';
            
            db.rewards.forEach(reward => {
                const canRedeem = currentUser.points >= reward.points;
                const item = `
                    <div class="reward-item ${!canRedeem ? 'disabled' : ''}" 
                         onclick="${canRedeem ? `openRedeemModal(${reward.id})` : ''}">
                        <div style="width: 80px; height: 80px; background: ${reward.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; color: white; font-size: 2rem;">
                            <i class="fas ${reward.icon}"></i>
                        </div>
                        <h4>${reward.name}</h4>
                        <div class="reward-cost">${reward.points} poin</div>
                        ${!canRedeem ? '<small style="color: #e74c3c;">Poin tidak cukup</small>' : '<small>Klik untuk menukar</small>'}
                    </div>
                `;
                container.innerHTML += item;
            });
            
            document.getElementById('userPoints').textContent = currentUser.points;
            
            // Render achievements
            const achievementGrid = document.getElementById('achievementGrid');
            achievementGrid.innerHTML = '';
            
            db.achievements.forEach(ach => {
                const hasAchievement = currentUser.achievements.includes(ach.id);
                const item = `
                    <div class="achievement-item ${!hasAchievement ? 'achievement-locked' : ''}">
                        <div class="achievement-icon" style="color: ${ach.color};">
                            <i class="fas ${ach.icon}"></i>
                        </div>
                        <h4>${ach.name}</h4>
                        <small>${ach.description}</small>
                    </div>
                `;
                achievementGrid.innerHTML += item;
            });
        }

        function openRedeemModal(rewardId) {
            selectedReward = db.rewards.find(r => r.id === rewardId);
            document.getElementById('redeemTitle').textContent = `Tukar ${selectedReward.name}`;
            document.getElementById('rewardDetails').innerHTML = `
                <div style="font-size: 4rem; color: ${selectedReward.color}; margin: 20px 0;">
                    <i class="fas ${selectedReward.icon}"></i>
                </div>
                <h3>${selectedReward.name}</h3>
                <p>Butuh ${selectedReward.points} poin</p>
                <p>Poin Anda: ${currentUser.points}</p>
                <p style="color: ${currentUser.points >= selectedReward.points ? 'green' : 'red'}; font-weight: bold;">
                    ${currentUser.points >= selectedReward.points ? ' Poin cukup!' : ' Poin tidak cukup'}
                </p>
            `;
            openModal('redeemModal');
        }

        function confirmRedeem() {
            if (!selectedReward || !currentUser) return;
            
            if (currentUser.points >= selectedReward.points) {
                // Deduct points
                const userIndex = db.users.findIndex(u => u.user === currentUser.user);
                db.users[userIndex].points -= selectedReward.points;
                
                // Save and refresh
                saveDB();
                currentUser = db.users[userIndex];
                
                showToast(`Berhasil menukar ${selectedReward.name}!`, 'success');
                closeModal('redeemModal');
                renderRewards();
                renderDashboard();
            } else {
                showToast('Poin tidak cukup!', 'error');
            }
        }

        // --- LEADERBOARD ---
        function renderLeaderboard() {
            const sortedUsers = [...db.users]
                .filter(u => u.role === 'user')
                .sort((a, b) => b.weight - a.weight);
            
            // Update top 3
            if (sortedUsers[0]) document.getElementById('top1Name').textContent = sortedUsers[0].name;
            if (sortedUsers[1]) document.getElementById('top2Name').textContent = sortedUsers[1].name;
            if (sortedUsers[2]) document.getElementById('top3Name').textContent = sortedUsers[2].name;
            
            // Update table
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            
            sortedUsers.forEach((user, index) => {
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${user.name} ${currentUser && currentUser.user === user.user ? '(Anda)' : ''}</td>
                        <td>${user.weight} kg</td>
                        <td>${user.points}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // --- DASHBOARD LOGIC ---
        function renderDashboard() {
            if (!currentUser) return;

            if (currentUser.role === 'admin') {
                // ADMIN VIEW
                document.getElementById('dashboardTitle').innerText = "Dashboard Admin";
                document.getElementById('userDashboard').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');

                document.getElementById('totalUsersCount').innerText = db.users.length - 1;
                document.getElementById('pendingPickups').innerText = db.pickups.filter(p => p.status === 'Pending').length;
                document.getElementById('totalReports').innerText = db.reports.length;

                const pickupBody = document.getElementById('adminPickupTable');
                pickupBody.innerHTML = '';
                db.pickups.forEach((p, index) => {
                    const row = `
                        <tr>
                            <td>${p.user}</td>
                            <td>${p.date}</td>
                            <td>${p.type}</td>
                            <td>${p.address}</td>
                            <td>
                                <button class="btn btn-primary btn-sm" onclick="processPickup(${index})">Proses</button>
                            </td>
                        </tr>
                    `;
                    pickupBody.innerHTML += row;
                });

                const reportList = document.getElementById('adminReportList');
                reportList.innerHTML = '';
                db.reports.forEach((r, i) => {
                    reportList.innerHTML += `
                        <div style="padding: 10px; border-bottom: 1px solid #eee;">
                            <strong>${r.loc}</strong><br>
                            <small>${r.note}</small>
                            <br><button class="btn btn-danger btn-sm" onclick="deleteReport(${i})">Hapus</button>
                        </div>
                    `;
                });

            } else {
                // USER VIEW
                document.getElementById('dashboardTitle').innerText = "Halo, " + currentUser.name;
                document.getElementById('userDashboard').classList.remove('hidden');
                document.getElementById('adminDashboard').classList.add('hidden');

                document.getElementById('userBalance').innerText = 'Rp ' + currentUser.balance.toLocaleString();
                document.getElementById('userWeight').innerText = currentUser.weight + ' Kg';
                document.getElementById('userPointsDash').innerText = currentUser.points;

                const histBody = document.getElementById('userHistoryBody');
                histBody.innerHTML = '';
                
                // Reload user from DB
                const freshUser = db.users.find(u => u.user === currentUser.user);
                currentUser = freshUser; 

                currentUser.history.forEach(h => {
                    const row = `
                        <tr>
                            <td>${h.date}</td>
                            <td>${h.type}</td>
                            <td>${h.weight} Kg</td>
                            <td style="color:green;">+Rp ${h.total.toLocaleString()}</td>
                            <td style="color:blue;">+${h.points} poin</td>
                        </tr>
                    `;
                    histBody.innerHTML += row;
                });

                // Bar Chart
                const chartContainer = document.getElementById('userChart');
                chartContainer.innerHTML = '';
                const data = [10, 25, 40, 35, 60, currentUser.weight]; 
                const months = ['Mei', 'Jun', 'Jul', 'Agt', 'Sep', 'Okt'];
                
                data.forEach((val, idx) => {
                    chartContainer.innerHTML += `
                        <div class="bar-group">
                            <div class="bar" style="height: ${val * 2.5}px;" data-value="${val}kg"></div>
                            <div class="bar-label">${months[idx]}</div>
                        </div>
                    `;
                });
            }
        }

        // Admin Actions
        function processPickup(index) {
            const pickup = db.pickups[index];
            const userIndex = db.users.findIndex(u => u.user === pickup.user);
            
            if (userIndex !== -1) {
                let pricePerKg = 2000;
                const priceItem = db.prices.find(p => p.type.toLowerCase().includes(pickup.type));
                if(priceItem) pricePerKg = priceItem.price;

                const total = pickup.weight * pricePerKg;
                const pointsEarned = Math.floor(total / 100); // 1 point per Rp100

                // Update User
                db.users[userIndex].balance += total;
                db.users[userIndex].weight += parseInt(pickup.weight);
                db.users[userIndex].points += pointsEarned;
                
                // Add achievement based on weight
                if (db.users[userIndex].weight >= 100 && !db.users[userIndex].achievements.includes('gold_weight')) {
                    db.users[userIndex].achievements.push('gold_weight');
                } else if (db.users[userIndex].weight >= 50 && !db.users[userIndex].achievements.includes('silver_weight')) {
                    db.users[userIndex].achievements.push('silver_weight');
                } else if (db.users[userIndex].weight >= 10 && !db.users[userIndex].achievements.includes('bronze_weight')) {
                    db.users[userIndex].achievements.push('bronze_weight');
                }
                
                // Add first deposit achievement if needed
                if (db.users[userIndex].history.length === 0 && !db.users[userIndex].achievements.includes('first_deposit')) {
                    db.users[userIndex].achievements.push('first_deposit');
                }
                
                // Add regular achievement check
                if (db.users[userIndex].history.length >= 2) {
                    const lastThree = db.users[userIndex].history.slice(-3);
                    // Check if last 3 deposits are within 30 days
                    if (!db.users[userIndex].achievements.includes('regular')) {
                        db.users[userIndex].achievements.push('regular');
                    }
                }

                db.users[userIndex].history.push({
                    date: new Date().toISOString().split('T')[0],
                    type: pickup.type,
                    weight: parseInt(pickup.weight),
                    total: total,
                    points: pointsEarned
                });

                // Remove pickup
                db.pickups.splice(index, 1);
                saveDB();
                showToast(`Setoran senilai Rp ${total.toLocaleString()} (+${pointsEarned} poin) berhasil dicatat.`, 'success');
                renderDashboard();
                renderLeaderboard();
            }
        }

        function deleteReport(index) {
            db.reports.splice(index, 1);
            saveDB();
            showToast('Laporan dihapus.', 'success');
            renderDashboard();
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            renderPrices();
            // Set today's date as default for pickup date
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('pickupDate');
            if (dateInput) dateInput.min = today;
        };
    </script>
</body>
</html>